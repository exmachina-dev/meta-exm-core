/dts-v1/;
/plugin/;

/ {
    compatible = "ti,beaglebone", "ti,beaglebone-black";

    /* identification */
    part-number = "BB-BONE-ARMAZ";
    version = "00A0";

    /* state the resources this cape uses or prepare to get winged! */
    exclusive-use =
        /* the pin header P8 uses */
        "P8.11", /* SWITCH_0      */
        "P8.12", /* SWITCH_1      */
        "P8.14", /* SWITCH_2      */
        "P8.13", /* FAN_0         */
        "P8.19", /* FAN_1         */
        /* the pin header P9 uses */
        "P9.39", /* TEMP_0        */
        "P9.40", /* TEMP_1        */
        /* the hardware IP uses */
        "ehrpwm2A", "ehrpwm2B";

    fragment@0 {
        target = <&am33xx_pinmux>;
        __overlay__ {
            switch_pins: pinmux_switch_pins {
                pinctrl-single,pins = <
                    0x034 0x37 // P8_11 (22) = switch_0 = GPIO1_13
                    0x030 0x37 // P8_12 (23) = switch_1 = GPIO1_12
                    0x028 0x37 // P8_14 (5)  = switch_2 = GPIO0_26
                >;
            };
        };
    };

    fragment@1 {
        target = <&ocp>;
        __overlay__ {
            /* avoid stupid warning */
            #address-cells = <1>;
            #size-cells = <1>;

            tscadc {
                compatible = "ti,ti-tscadc";
                reg = <0x44e0d000 0x1000>;

                interrupt-parent = <&intc>;
                interrupts = <16>;
                ti,hwmods = "adc_tsc";
                status = "okay";

                adc {
                    ti,adc-channels = <0 1>;
                };
            };

            thermistors {
                compatible = "bone-iio-helper";
                vsense-name  = "AIN0", "AIN1";
                vsense-scale = <100     100>;
                status = "okay";
            };
            gpio_keys {
                compatible = "gpio-keys";
                pinctrl-names = "default";
                pinctrl-0 = <&switch_pins>;
                #address-cells = <1>;
                #size-cells = <0>;

                switch_0 {
                    label = "Switch-2";
                    debounce_interval = <50>;
                    linux,code = <1>;
                    gpios = <&gpio2 4 0x5>;
                    gpio-key,wakeup;
                };
                switch_1 {
                    label = "Switch-1";
                    debounce_interval = <50>;
                    linux,code = <2>;
                    gpios = <&gpio1 13 0x5>;
                    gpio-key,wakeup;
                };
                switch_2 {
                    label = "Switch-2";
                    debounce_interval = <50>;
                    linux,code = <3>;
                    gpios = <&gpio1 30 0x5>;
                    gpio-key,wakeup;
                };
            };
        };
    };

    fragment@2 {
        target = <&am33xx_pinmux>;
        __overlay__ {
            fan_0: pinmux_fan_0_pins {
                pinctrl-single,pins = <0x024  0x4>; /* P8_13 (ZCZ ball T10) | MODE 4 */
            };
            fan_1: pinmux_fan_1_pins {
                pinctrl-single,pins = <0x020  0x4>; /* P8_19 (ZCZ ball U10) | MODE 4 */
            };
        };
    };

    fragment@3 {
        target = <&ocp>;
        __overlay__ {
            pwm_fan_0 {
                compatible	= "pwm_test";
                pwms 		= <&ehrpwm2 1 500000 1>;
                pwm-names 	= "FAN_0";

                pinctrl-names	= "default";
                pinctrl-0	= <&fan_0>;

                enabled		= <1>;
                duty		= <0>;
                status 		= "okay";
            };
            pwm_fan_1 {
                compatible	= "pwm_test";
                pwms 		= <&ehrpwm2 1 500000 1>;
                pwm-names 	= "FAN_1";

                pinctrl-names	= "default";
                pinctrl-0	= <&fan_1>;

                enabled		= <1>;
                duty		= <0>;
                status 		= "okay";
            };
        };
    };
};
